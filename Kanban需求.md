# Kanban 任务管理系统需求规格说明书 (PRD)

| 项目名称 | SekaiBoard |
| :--- | :--- |
| **文档版本** | v1.3.0 |
| **最后更新日期** | 2025-12-21 |
| **状态** | 开发中 (Implementation Phase) |

---

## 1. 项目概述 (Introduction)

### 1.1 背景
本项目旨在开发一款轻量级、支持无限层级嵌套的 Kanban（看板）任务管理工具。通过直观的 GUI 界面，帮助用户以可视化的方式管理项目进度，特别强调对任务层级的管理和“同源卡片”的同步机制。

### 1.2 目标
-   提供流畅的拖拽体验，支持复杂的任务嵌套（Nest）与排序（Insert）。
-   实现“同源卡片”机制，支持同一任务在不同生命周期阶段（列）的映射与状态同步。
-   集成 AI 辅助功能，通过自然语言对话分析和操作看板数据。
-   提供全键盘支持和高效的搜索能力。

### 1.3 范围 (Scope)
*   **In-Scope**: 前端 React 应用、拖拽交互、WIP 限制逻辑、YAML 数据导入导出、AI 助手集成、本地/后端自动保存。
*   **Out-of-Scope**: 多用户实时协作、复杂的权限管理系统、移动端原生 App 适配（当前仅限 Web 响应式）。

---

## 2. 功能需求 (Functional Requirements)

### 2.1 模块：项目与导航 (Project & Navigation)

#### REQ-PROJ-001: 侧边栏 (Sidebar)
*   **展示**: 显示所有项目列表。
*   **搜索**: 顶部提供搜索框，支持快捷键 `Ctrl+K` 快速聚焦。
*   **操作**:
    *   **切换项目**: 单击项目卡片非文字区域，主视图切换至该项目看板。
    *   **重命名**: 双击项目名称进入编辑模式（`Enter` 保存，`Esc` 取消，失焦保存）。
    *   **删除**: 悬停显示删除图标，点击后需确认。
*   **数据导出**: 提供 YAML 格式的全局数据导出/导入功能。
*   **主题切换**: 提供亮色/暗色模式切换。

#### REQ-PROJ-002: 项目主控 (Main Header)
*   **信息展示**: 显示当前项目名称、顶层任务统计。
*   **项目简介**: 提供可编辑的文本域展示 Project Description。
*   **重命名**: 双击顶部大标题可重命名项目。
*   **全局搜索**: 输入卡片 ID（支持 `#` 前缀匹配），精准定位并高亮显示目标卡片（自动展开父级）。

---

### 2.2 模块：看板核心 (Board Core)

#### REQ-BOARD-001: 列管理 (Columns)
*   **预设列**: 系统固定包含四列：
    1.  **Backlog**: 需求池/构想。
    2.  **Todos**: 待办事项/详细设计。
    3.  **In Progress**: 进行中（受 WIP 限制）。
    4.  **Done**: 已完成。
*   **WIP 限制**:
    *   仅 `In Progress` 列生效。
    *   **计数规则**: 仅统计**叶子节点**（最底层子任务）数量。
    *   **交互**: 点击列头数字可修改 WIP 限制值。
    *   **校验**: 拖入任务时，若叶子节点总数超过 WIP，阻止拖入并提示。

#### REQ-BOARD-002: 任务卡片 (Task Card)
*   **基本元素**:
    *   **内容**: 文本描述，支持多行。
    *   **进度条**: 若有子任务，底部显示完成度进度条（基于子任务在 Done 列的比例）。
		*	进度条计算：同源卡片done列叶节点数/同源卡片叶节点数
    *   **优先级**: 左侧显示颜色标记（High: Red, Medium: Orange, Low: Blue）。
*   **交互操作**:
	*	**聚焦**：鼠标移到卡片上会额外显示以下内容
    	*   **ID**: 唯一标识符（如 `#a1b2`），悬停显示。
		*	**创建时间**：显示创建时间距今时间
		*	**子任务计数**：父卡片会显示所有同源卡片
	*   **编辑**: 双击文本内容进入编辑模式（`Enter` 提交）。悬停文本有视觉反馈。
    *   **展开/收起**:
        *   仅当卡片**当前实例**包含子任务时，显示展开箭头（Chevron）。
        *   点击内容区空白处或箭头均可切换展开状态。
    *   **添加子任务**: 点击 `+` 号。
        *   自动聚焦新输入框。
        *   `Enter` 提交并保持输入框以继续添加。
        *   `Esc` 或点击外部空白（失焦）提交当前内容并关闭输入框。
        *   输入空格不会触发父级拖拽。
    *   **菜单**: 提供删除、移动、复制、优先级修改选项。
	*	**快捷删除**：删除当前卡片

#### REQ-BOARD-003: 基础拖拽
*   **Insert 模式**: 拖动卡片到两张卡片之间，显示蓝色横线提示插入位置。
*   **Nest 模式**: 拖动卡片悬停在另一张卡片上方，目标卡片显示蓝色外框，松手后成为其子卡片。

#### REQ-BOARD-004: 智能复制与上下文 (Ctrl + Drag)
*   **触发条件**: 按住 `Ctrl` (或 `Meta`) 键进行拖拽。
*   **场景 A (顶层卡片)**:
    *   复制该卡片本身，**不携带**其子任务。
*   **场景 B (子卡片/跨列)**:
    *   **自动归组 (Auto-Group)**: 若目标列存在与源父级 ID 相同的“同源父级”，自动将拖动的卡片归入该父级下（无视具体拖拽位置）。
    *   **上下文复制**: 若目标列无同源父级，在目标列**底部**自动创建一个父级副本，并将拖动的卡片归入其中。

---

### 2.3 模块：AI 助手 (AI Assistant)

#### REQ-AI-001: 对话界面
*   提供类似 Chatbot 的侧边栏或浮窗。
*   支持上下文理解项目简介、当前看板状态。

#### REQ-AI-002: MCP (Model Context Protocol) 能力
*   **读取**: 获取项目结构、任务详情。
*   **修改**: 允许 AI 生成对 YAML 元数据的修改建议（Diff 视图）。
*   **确认**: 用户需手动确认 AI 的修改建议（Apply/Reject）。

---
### 2.4模块：项目管理模块

#### REQ-PM-001：项目管理页
*	将所有项目在该页面展示，分为Planning、Active、Complete三列。

#### REQ-PM-002：项目卡片
*   **基本元素**:
    *   **名字**: 文本描述
    *   **进度条**: 显示该项目中所有done叶节点/所有叶节点
    *   **分类**: 显示颜色（Planning: Grey, Active: Yellow, Complete: Green）。
*	**交互操作**：
	*	**重命名**：双击项目名称重命名
	*	**进入项目**：单击卡片空白区域进入该项目

---

## 3. 非功能需求 (Non-Functional Requirements)

### 3.1 性能 (Performance)
*   **渲染**: 
*   **响应**: 

### 3.2 数据持久化 (Persistence)
*   **自动保存**: 任何状态变更（增删改、拖拽）后，自动触发防抖（Debounce ~1s）保存机制，调用后端 API 更新 YAML 文件。
*   **格式**: 数据以 YAML 格式存储，保证可读性和可移植性。

### 3.3 交互体验 (UX Guidelines)
*   **防误触**:
    *   编辑输入框阻止事件冒泡，防止触发拖拽。
    *   点击卡片标题/内容时不应触发页面跳转（仅空白处或专门按钮触发）。
*   **视觉反馈**:
    *   拖拽时源卡片半透明。
    *   搜索高亮样式清晰（醒目边框+阴影）。
    *   不可操作元素（如无子任务时的展开箭头）应隐藏或禁用。

---

## 4. 数据结构 (Data Model)

```typescript
type ColumnId = 'backlog' | 'todo' | 'in-progress' | 'done';

interface Task {
    id: string;        // 唯一实例 ID
    sourceId?: string; // 同源标识符（用于跨列关联）
    content: string;
    children: Task[];  // 递归定义
    isExpanded?: boolean;
    priority?: 'low' | 'medium' | 'high';
    createdAt: number;
}

interface Project {
    id: string;
    name: string;
    description: string;
    wipLimit: number;
    columns: Record<ColumnId, Task[]>;
}
```
